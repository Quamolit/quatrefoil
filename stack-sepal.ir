{:definitions {"core/render-canvas!" ["defn" "render-canvas!" ["markup" "states-ref" "instants" "scene"] ["let" [["build-mutate" ["fn" ["coord" "new-state"] ["println" "|Mutate states:" "new-state"] ["swap!" "states-ref" "assoc-in" ["conj" "coord" "'data"] "new-state"]]] ["new-tree" ["render-component" "markup" "@tree-ref" ["[]"] ["get" "@states-ref" [":name" "markup"]] "build-mutate" "instants"]]] ["if" ["some?" "@tree-ref"] ["let" [["changes-ref" ["atom" ["[]"]]] ["collect!" ["fn" ["x"] ["swap!" "changes-ref" "conj" "x"]]]] ["diff-tree" "@tree-ref" "new-tree" ["[]"] "collect!"] [".log" "js/console" "@changes-ref"]] ["build-tree" ["[]"] ["purify-tree" "new-tree"]]] ["reset!" "tree-ref" "new-tree"] [".log" "js/console" "|Tree:" "new-tree"]]], "main/dispatch!" ["defn" "dispatch!" ["op" "op-data"] ["println" "|Dispatch:" "op" "op-data"]], "dsl.alias/sphere" ["defn" "sphere" ["props" "&" "children"] ["create-element" ":sphere" "props" "children"]], "dsl.render/render-component" ["defn" "render-component" ["markup" "prev-tree" "coord" "states" "build-mutate" "instants"] [".log" "js/console" "|Component states:" "states"] ["if" ["and" ["some?" "prev-tree"] ["let" [["prev-args" [":args" "prev-tree"]] ["prev-states" [":states" "prev-tree"]] ["prev-instants" [":instants" "prev-tree"]]] ["and" ["=seq?" [":args" "markup"] "prev-args"] ["identical?" "states" "prev-states"] ["identical?" "instants" "prev-instants"]]]] "prev-tree" ["let" [["comp-name" [":name" "markup"]] ["base-coord" ["conj" "coord" "comp-name"]] ["hooks" [":hooks" "markup"]] ["state" ["if" ["contains?" "states" "'data"] ["get" "states" "'data"] ["let" [["init-state" [":init-state" "hooks"]]] ["apply" "init-state" [":args" "markup"]]]]] ["update-state" [":update-state" "hooks"]] ["mutate!" ["fn" ["&" "args"] ["let" [["new-state" ["apply" "update-state" ["cons" "state" "args"]]]] [".log" "js/console" "|During mutate:" "base-coord" "state" "new-state" "states"] ["build-mutate" "base-coord" "new-state"]]]] ["instant" ["get" "instants" "comp-name"]] ["tree" ["->" [":render" "markup"] ["apply" [":args" "markup"]] ["apply" ["list" "state" "mutate!" ["get" "instants" "'data"]]] ["render-markup" [":tree" "prev-tree"] "base-coord" "base-coord" "states" "build-mutate" "instant"]]]] ["merge" "markup" ["{}" [":tree" "tree"] [":states" "states"] [":instants" "instants"]]]]]], "dsl.render/render-shape" ["defn" "render-shape" ["markup" "prev-markup" "coord" "comp-coord" "states" "build-mutate" "instants"] ["let" [["prev-children" [":children" "prev-markup"]]] ["--" ".log" "js/console" "|Shape:" "markup"] ["->" "markup" ["assoc" ":coord" "coord"] ["update" ":children" ["fn" ["children"] ["->>" "children" ["map" ["fn" ["entry"] ["update" "entry" "1" ["fn" ["child"] ["let" [["k" ["first" "entry"]]] ["render-markup" "child" ["get" "prev-children" "k"] ["conj" "coord" "k"] "comp-coord" ["get" "states" "k"] "build-mutate" ["get" "instants" "k"]]]]]]] ["into" ["{}"]]]]]]]], "dsl.alias/group" ["defn" "group" ["props" "&" "children"] ["create-element" ":group" "props" "children"]], "main/-main!" ["defn" "-main!" [] ["enable-console-print!"] ["devtools/install!"] ["if" ["not" ["empty?" "ssr-stages"]] ["let" [["target" [".querySelector" "js/document" "|#app"]]] ["falsify-stage!" "target" ["render-element" ["comp-container" "@store-ref" "ssr-stages"] "states-ref"] "dispatch!"]]] ["render-app!"] ["let" [["canvas-el" ["js/document.querySelector" "|canvas"]]] ["reset!" "renderer-ref" ["js/THREE.WebGLRenderer." ["clj->js" ["{}" [":canvas" "canvas-el"] [":antialias" "true"]]]]] [".addEventListener" "canvas-el" "|click" ["fn" ["event"] ["on-canvas-click" "event" "dispatch!" "tree-ref"]]]] [".setSize" "@renderer-ref" "js/window.innerWidth" "js/window.innerHeight"] ["render-canvas-app!"] ["add-watch" "store-ref" ":changes" "render-canvas-app!"] ["add-watch" "states-ref" ":changes" "render-canvas-app!"] ["println" "|App started!"]], "dsl.object3d-dom/camera-ref" ["defonce" "camera-ref" ["atom" "nil"]], "dsl.alias/point-light" ["defn" "point-light" ["props" "&" "children"] ["create-element" ":point-light" "props" "children"]], "main/on-jsload!" ["defn" "on-jsload!" [] ["render-canvas-app!"] ["println" "|Code updated."]], "comp.canvas/comp-canvas" ["def" "comp-canvas" ["create-comp" ":canvas" ["{}"] ["fn" ["store"] ["fn" ["state" "mutate!" "instant"] ["scene" ["{}"] ["comp-demo"] ["sphere" ["{}" [":params" ["{}" [":radius" "4"] [":x" "40"]]] [":material" ["{}" [":kind" ":mesh-basic"] [":opacity" "0.6"] [":color" "0x9050c0"]]] [":event" ["{}" [":click" ["fn" ["event" "dispatch!"] [".log" "js/console" "|Click:" "event"] ["dispatch!" ":canvas" "nil"]]]]]]] ["point-light" ["{}" [":params" ["{}" [":color" "0xffaaaa"] [":x" "60"] [":y" "20"] [":z" "0"] [":intensity" "1"] [":distance" "400"]]]]] ["perspective-camera" ["{}" [":params" ["{}" [":x" "10"] [":y" "-10"] [":z" "100"] [":fov" "45"] [":aspect" ["/" "js/window.innerWidth" "js/window.innerHeight"]] [":near" "0.1"] [":far" "1000"]]]]]]]]]], "main/render-app!" ["defn" "render-app!" [] ["let" [["target" [".querySelector" "js/document" "|#app"]]] ["render!" ["comp-container" "@store-ref"] "target" "dispatch!" "states-ref"]]], "dsl.object3d-dom/create-perspective-camera" ["defn" "create-perspective-camera" ["params"] ["let" [["fov" [":fov" "params"]] ["aspect" [":aspect" "params"]] ["near" [":near" "params"]] ["far" [":far" "params"]] ["object3d" ["js/THREE.PerspectiveCamera." "fov" "aspect" "near" "far"]]] [".set" "object3d.position" [":x" "params"] [":y" "params"] [":z" "params"]] ["reset!" "camera-ref" "object3d"] "object3d"]], "dsl.object3d-dom/build-tree" ["defn" "build-tree" ["coord" "tree"] ["let" [["object3d" ["create-element" ["dissoc" "tree" ":children"]]] ["children" ["->>" [":children" "tree"] ["map" ["fn" ["entry"] ["update" "entry" "1" ["fn" ["child"] ["build-tree" ["conj" "coord" ["first" "entry"]] "child"]]]]] ["into" ["{}"]]]] ["virtual-element" ["{}" [":object3d" "object3d"] [":children" "children"]]]] ["doseq" ["[]" "entry" "children"] ["let" [["child" ["last" "entry"]]] ["--" ".log" "js/console" "|Child:" "child" "entry"] [".add" "object3d" "child"]]] ["swap!" "virtual-tree-ref" "assoc-in" ["conj" "coord" "'data"] "virtual-element"] "object3d"]], "dsl.diff/diff-params" ["defn" "diff-params" ["prev-params" "params" "coord" "collect!"]], "dsl.alias/perspective-camera" ["defn" "perspective-camera" ["props" "&" "children"] ["create-element" ":perspective-camera" "props" "children"]], "dsl.object3d-dom/create-sphere-element" ["defn" "create-sphere-element" ["params" "material" "event" "comp-coord"] ["let" [["geometry" ["js/THREE.SphereGeometry." ["or" [":radius" "params"] "8"] ["or" [":width-segments" "params"] "32"] ["or" [":height-segments" "params"] "32"]]] ["object3d" ["js/THREE.Mesh." "geometry" ["create-material" "material"]]]] [".set" "object3d.position" [":x" "params"] [":y" [":y" "params"]] [":z" [":z" "params"]]] ["set!" "object3d.coord" "comp-coord"] [".log" "js/console" "|Sphere:" "object3d"] "object3d"]], "dsl.alias/create-comp" ["defn" "create-comp" ["comp-name" "hooks" "render"] ["fn" ["&" "args"] ["Component." "comp-name" "args" ["{}"] ["{}"] "render" "nil" ["merge" "basic-hooks" "hooks"] "false"]]], "dsl.alias/create-element" ["defn" "create-element" ["el-name" "props" "children"] ["Shape." "el-name" [":params" "props"] [":material" "props"] [":event" "props"] ["if" ["seq?" "children"] ["->>" "children" ["map-indexed" "vector"] ["into" ["{}"]]] "children"] "nil"]], "dsl.object3d-dom/virtual-tree-ref" ["defonce" "virtual-tree-ref" ["atom" ["{}"]]], "comp.canvas/comp-demo" ["def" "comp-demo" ["create-comp" ":demo" ["{}" [":init-state" ["fn" ["&" "args"] "0"]] [":update-state" ["fn" ["state" "x"] ["inc" "state"]]]] ["fn" [] ["fn" ["state" "mutate!" "instant"] ["group" ["{}"] ["box" ["{}" [":params" ["{}" [":width" "16"] [":height" "4"] [":depth" "6"]]] [":material" ["{}" [":kind" ":mesh-basic"] [":color" "0x808080"] [":opacity" "0.6"]]] [":event" ["{}" [":click" ["fn" ["event" "dispatch!"] [".log" "js/console" "|Click:" "event"] ["dispatch!" ":demo" "nil"] ["mutate!" "|Mutate demo"]]]]]]] ["group" ["{}"]]]]]]], "dsl.object3d-dom/set-event" ["defn" "set-event" []], "util.core/purify-tree" ["defn" "purify-tree" ["tree"] ["if" ["comp?" "tree"] ["recur" [":tree" "tree"]] ["update" "tree" ":children" ["fn" ["children"] ["->>" "children" ["map" ["fn" ["entry"] ["update" "entry" "1" ["fn" ["child"] ["purify-tree" "child"]]]]] ["into" ["{}"]]]]]]], "dsl.object3d-dom/remove-child" ["defn" "remove-child" []], "util.core/=seq?" ["defn" "=seq?" ["xs" "ys"] ["let" [["xs-empty?" ["empty?" "xs"]] ["ys-empty?" ["empty?" "ys"]]] ["if" "xs-empty?" "ys-empty?" ["if" "ys-empty?" ["if" ["identical?" ["first" "xs"] ["first" "ys"]] ["recur" ["rest" "xs"] ["rest" "ys"]] "false"]]]]], "dsl.object3d-dom/create-element" ["defn" "create-element" ["element"] [".log" "js/console" "|Element:" "element" [":coord" "element"]] ["let" [["params" ["or" [":params" "element"] ["{}"]]] ["material" ["or" [":material" "element"] ["{}" [":kind" ":mesh-basic"] [":color" "0xa0a0a0"]]]] ["event" [":event" "element"]] ["coord" [":coord" "element"]]] ["case" [":name" "element"] [":scene" "global-scene"] [":group" ["js/THREE.Group."]] [":box" ["create-box-element" "params" "material" "event" "coord"]] [":sphere" ["create-sphere-element" "params" "material" "event" "coord"]] [":point-light" ["create-point-light" "params"]] [":perspective-camera" ["create-perspective-camera" "params"]] ["do" [".warn" "js/console" "|Unknown element" "element"] ["js/THREE.Object3D."]]]]], "dsl.object3d-dom/global-scene" ["defonce" "global-scene" ["js/THREE.Scene."]], "main/ssr-stages" ["def" "ssr-stages" ["let" [["ssr-element" [".querySelector" "js/document" "|#ssr-stages"]] ["ssr-markup" [".getAttribute" "ssr-element" "|content"]]] ["read-string" "ssr-markup"]]], "main/render-canvas-app!" ["defn" "render-canvas-app!" [] [".log" "js/console" "|Rerender" "@store-ref" "@states-ref"] ["render-canvas!" ["comp-canvas" "@store-ref"] "states-ref" "@instants-ref" "global-scene"] [".render" "@renderer-ref" "global-scene" "@camera-ref"]], "comp.container/comp-container" ["def" "comp-container" ["create-comp" ":container" ["fn" ["store"] ["fn" ["state" "mutate!"] ["div" ["{}" [":style" ["merge" "ui/global"]]] ["canvas" ["{}" [":attrs" ["{}" [":id" "|canvas"] [":width" "js/window.innerWidth"] [":height" "js/window.innerHeight"]]] [":style" ["{}"]]]]]]]]], "dsl.object3d-dom/set-material" ["defn" "set-material" []], "main/store-ref" ["defonce" "store-ref" ["atom" ["{}"]]], "types/Component" ["defrecord" "Component" ["name" "args" "states" "instants" "render" "tree" "hooks" "removing?"]], "dsl.object3d-dom/on-canvas-click" ["defn" "on-canvas-click" ["event" "dispatch!" "tree-ref"] ["let" [["mouse" ["js/THREE.Vector2."]] ["raycaster" ["js/THREE.Raycaster."]]] ["set!" "mouse.x" ["dec" ["*" "2" ["/" "event.clientX" "js/window.innerWidth"]]]] ["set!" "mouse.y" ["-" "1" ["*" "2" ["/" "event.clientY" "js/window.innerHeight"]]]] [".setFromCamera" "raycaster" "mouse" "@camera-ref"] ["let" [["intersects" [".intersectObjects" "raycaster" ["let" [["children" ["clj->js" ["[]"]]] ["collect!" ["fn" ["x"] [".push" "children" "x"]]]] ["collect-children" "global-scene" "collect!"] "children"]]] ["maybe-target" ["aget" "intersects" "0"]]] [".log" "js/console" "intersects"] ["if" ["some?" "maybe-target"] ["let" [["coord" "maybe-target.object.coord"] ["target-el" ["find-element" "@tree-ref" "coord"]] ["maybe-handler" [":click" [":event" "target-el"]]]] ["if" ["some?" "maybe-handler"] ["maybe-handler" "event" "dispatch!"] ["println" "|Found no handler for" "coord"]]]]]]], "dsl.render/render-markup" ["defn" "render-markup" ["markup" "prev-markup" "coord" "comp-coord" "states" "build-mutate" "instants"] ["if" ["comp?" "markup"] ["render-component" "markup" "prev-markup" "coord" ["get" "states" [":name" "markup"]] "build-mutate" "instants"] ["render-shape" "markup" "prev-markup" "coord" "comp-coord" "states" "build-mutate" "instants"]]], "util.core/comp?" ["defn" "comp?" ["x"] ["=" "Component" ["type" "x"]]], "dsl.alias/box" ["defn" "box" ["props" "&" "children"] ["create-element" ":box" "props" "children"]], "dsl.object3d-dom/create-material" ["defn" "create-material" ["material"] ["case" [":kind" "material"] [":line-basic" ["js/THREE.LineBasicMaterial." ["clj->js" ["dissoc" "material" ":kind"]]]] [":mesh-basic" ["js/THREE.MeshBasicMaterial." ["clj->js" ["dissoc" "material" ":kind"]]]] ["do" [".warn" "js/console" "|Unknown material:" "material"] ["js/THREE.LineBasicMaterial." ["clj->js" ["dissoc" "material" ":kind"]]]]]], "util.core/find-element" ["defn" "find-element" ["tree" "comp-coord"] [".log" "js/console" "|Find..." "tree" "comp-coord"] ["if" ["empty?" "comp-coord"] "tree" ["let" [["cursor" ["first" "comp-coord"]]] ["if" ["comp?" "tree"] ["if" ["=" "cursor" [":name" "tree"]] ["recur" [":tree" "tree"] ["rest" "comp-coord"]] "nil"] ["if" ["contains?" [":children" "tree"] "cursor"] ["recur" ["get-in" "tree" ["[]" ":children" "cursor"]] ["rest" "comp-coord"]] "nil"]]]]], "types/Shape" ["defrecord" "Shape" ["name" "params" "material" "event" "children" "coord"]], "dsl.diff/diff-events" ["defn" "diff-events" ["prev-events" "events" "coord" "collect!"] ["let" [["prev-event-names" ["into" ["#{}"] ["keys" "prev-events"]]] ["event-names" ["into" ["#{}"] ["keys" "events"]]] ["added-events" ["set/difference" "event-names" "prev-event-names"]] ["removed-events" ["set/difference" "prev-event-names" "event-names"]]] ["if" ["not" ["empty?" "added-events"]] ["collect!" ["[]" "coord" ":add-events" "added-events"]]] ["if" ["not" ["empty?" "removed-events"]] ["collect!" ["[]" "coord" ":remove-events" "removed-events"]]]]], "dsl.object3d-dom/append-child" ["defn" "append-child" []], "dsl.diff/diff-material" ["defn" "diff-material" ["prev-material" "material" "coord" "collect!"] "nil"], "main/states-ref" ["defonce" "states-ref" ["atom" ["{}"]]], "dsl.alias/line" ["defn" "line" ["props" "&" "children"] ["create-element" ":line" "props" "children"]], "main/renderer-ref" ["defonce" "renderer-ref" ["atom" "nil"]], "main/instants-ref" ["defonce" "instants-ref" ["atom" ["{}"]]], "util.core/shape?" ["defn" "shape?" ["x"] ["=" "Shape" ["type" "x"]]], "dsl.object3d-dom/create-box-element" ["defn" "create-box-element" ["params" "material" "event" "comp-coord"] ["let" [["geometry" ["js/THREE.BoxGeometry." [":width" "params"] [":height" "params"] [":depth" "params"]]] ["object3d" ["js/THREE.Mesh." "geometry" ["create-material" "material"]]]] [".set" "object3d.position" [":x" "params"] [":y" [":y" "params"]] [":z" [":z" "params"]]] ["set!" "object3d.coord" "comp-coord"] "object3d"]], "dsl.alias/camera" ["defn" "camera" ["props" "&" "children"] ["create-element" ":camera" "props" "children"]], "core/tree-ref" ["defonce" "tree-ref" ["atom" "nil"]], "util.core/collect-children" ["defn" "collect-children" ["element" "collect!"] [".forEach" "element.children" ["fn" ["child"] ["--" ".log" "js/console" "|Child:" "child"] ["collect!" "child"] ["if" ["some?" "child.children"] ["collect-children" "child" "collect!"]]]]], "dsl.alias/scene" ["defn" "scene" ["props" "&" "children"] ["create-element" ":scene" "props" "children"]], "dsl.diff/diff-tree" ["defn" "diff-tree" ["prev-tree" "tree" "coord" "collect!"] ["if" ["some?" "prev-tree"] ["if" ["some?" "tree"] ["do" ["diff-params" [":params" "prev-tree"] [":params" "tree"] "coord" "collect!"] ["diff-material" [":material" "prev-tree"] [":material" "tree"] "coord" "collect!"] ["diff-events" [":event" "prev-tree"] [":event" "tree"] "coord" "collect!"]] ["collect!" ["[]" "coord" ":remove"]]] ["if" ["some?" "tree"] ["collect!" ["[]" ":create" "tree"]] "nil"]]], "dsl.object3d-dom/create-point-light" ["defn" "create-point-light" ["params"] ["let" [["color" [":color" "params"]] ["intensity" [":intensity" "params"]] ["distance" [":distance" "params"]] ["object3d" ["js/THREE.PointLight." "color" "intensity" "distance"]]] [".set" "object3d.position" [":x" "params"] [":y" "params"] [":z" "params"]] [".log" "js/console" "|Light:" "object3d"] "object3d"]], "dsl.object3d-dom/set-param" ["defn" "set-param" []], "dsl.alias/basic-hooks" ["def" "basic-hooks" ["{}" [":init-state" ["fn" ["&" "args"] ["{}"]]] [":init-instant" ["fn" ["&" "args"] ["{}"]]] [":on-mutate" "merge"] [":on-update" "merge"] [":on-tick" ["fn" []]] [":on-update" ["fn" []]] [":on-unmount" ["fn" []]] [":remove?" ["fn" [] "false"]]]]}, :namespaces {"dsl.diff" ["ns" "quatrefoil.dsl.diff" [":require" ["[]" "clojure.set" ":as" "set"]]], "comp.canvas" ["ns" "quatrefoil.comp.canvas" [":require" ["[]" "quatrefoil.dsl.alias" ":refer" ["[]" "create-comp" "group" "box" "sphere" "point-light" "perspective-camera" "scene"]]]], "util.core" ["ns" "quatrefoil.util.core" [":require" ["[]" "quatrefoil.types" ":refer" ["[]" "Component" "Shape"]]]], "comp.container" ["ns" "quatrefoil.comp.container" [":require" ["[]" "hsl.core" ":refer" ["[]" "hsl"]] ["[]" "respo-ui.style" ":as" "ui"] ["[]" "respo.alias" ":refer" ["[]" "create-comp" "div" "span" "canvas"]] ["[]" "respo.comp.space" ":refer" ["[]" "comp-space"]] ["[]" "respo.comp.text" ":refer" ["[]" "comp-text"]]]], "types" ["ns" "quatrefoil.types"], "main" ["ns" "quatrefoil.main" [":require" ["[]" "respo.core" ":refer" ["[]" "render!" "clear-cache!" "falsify-stage!" "render-element" "gc-states!"]] ["[]" "quatrefoil.comp.container" ":refer" ["[]" "comp-container"]] ["[]" "cljs.reader" ":refer" ["[]" "read-string"]] ["[]" "quatrefoil.core" ":refer" ["[]" "render-canvas!" "tree-ref"]] ["[]" "quatrefoil.comp.canvas" ":refer" ["[]" "comp-canvas"]] ["[]" "devtools.core" ":as" "devtools"] ["[]" "cljsjs.three"] ["[]" "quatrefoil.dsl.object3d-dom" ":refer" ["[]" "camera-ref" "global-scene" "on-canvas-click"]]]], "dsl.object3d-dom" ["ns" "quatrefoil.dsl.object3d-dom" [":require" ["[]" "cljsjs.three"] ["[]" "quatrefoil.util.core" ":refer" ["[]" "purify-tree" "collect-children" "find-element"]]]], "core" ["ns" "quatrefoil.core" [":require" ["[]" "quatrefoil.dsl.render" ":refer" ["[]" "render-component"]] ["[]" "quatrefoil.dsl.diff" ":refer" ["[]" "diff-tree"]] ["[]" "quatrefoil.dsl.object3d-dom" ":refer" ["[]" "build-tree"]] ["[]" "quatrefoil.util.core" ":refer" ["[]" "purify-tree"]]]], "dsl.alias" ["ns" "quatrefoil.dsl.alias" [":require" ["[]" "quatrefoil.types" ":refer" ["[]" "Shape" "Component"]]]], "dsl.render" ["ns" "quatrefoil.dsl.render" [":require" ["[]" "quatrefoil.util.core" ":refer" ["[]" "comp?" "shape?" "=seq?"]]]]}, :procedures {"dsl.diff" [], "dsl" [], "comp.canvas" [], "util.core" [], "types" [], "main" [["set!" [".-onload" "js/window"] "-main!"]], "render.object3d-dom" [], "alias" [], "core" [], "dsl.alias" [], "dsl.render" []}, :package "quatrefoil"}